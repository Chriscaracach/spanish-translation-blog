La seguridad es importante. Nadie quiere ser la persona que aboga por menos seguridad. AsÃ­ que nadie quiere decirlo. Pero alguien tiene que hacerlo.

Supongo que lo dirÃ© yo.

La forma en que funciona la npm audit estÃ¡ rota. Su lanzamiento como predeterminado despuÃ©s de cada instalaciÃ³n con npm fue apresurado, poco considerado e inadecuado para las herramientas front-end.

Â¿Has oÃ­do la historia del pastorcito mentiroso? Spoiler: el lobo se come las ovejas. Si no queremos que nuestras ovejas sean comidas, necesitamos mejores herramientas.

A partir de hoy, la npm audit es una mancha en todo el ecosistema de npm. El mejor momento para solucionarlo fue antes de lanzarlo como predeterminado. El siguiente mejor momento para solucionarlo es ahora.

En esta publicaciÃ³n, describirÃ© brevemente cÃ³mo funciona, por quÃ© estÃ¡ roto y quÃ© cambios espero ver.

Nota: este artÃ­culo estÃ¡ escrito con un tono crÃ­tico y un tanto sarcÃ¡stico. Entiendo que es muy difÃ­cil mantener proyectos masivos como Node.js/npm, y que los errores pueden tardar en hacerse evidentes. Estoy frustrado solo por la situaciÃ³n, no por las personas involucradas. Mantuve el tono sarcÃ¡stico porque mi nivel de frustraciÃ³n ha aumentado a lo largo de los aÃ±os y no quiero pretender que la situaciÃ³n no es tan grave como realmente lo es. Sobre todo, estoy frustrado al ver a todas las personas para las que esta es su primera experiencia de programaciÃ³n, asÃ­ como a todas las personas que se bloquean para implementar sus cambios debido a advertencias irrelevantes. Â¡Estoy emocionado de que se estÃ© considerando este problema y harÃ© todo lo posible para proporcionar informaciÃ³n sobre las soluciones propuestas! ğŸ’œ

Â¿CÃ³mo funciona npm audit?
Saltea esta parte si ya sabes cÃ³mo funciona.

Tu aplicaciÃ³n Node.js tiene un Ã¡rbol de dependencias. PodrÃ­a verse asÃ­:

your-app
  - view-library@1.0.0
  - design-system@1.0.0
  - model-layer@1.0.0
    - database-layer@1.0.0
      - network-utility@1.0.0

Lo mÃ¡s probable es que sea mucho mÃ¡s profundo.

Supongamos que se descubre una vulnerabilidad en network-utility@1.0.0:

your-app
  - view-library@1.0.0
  - design-system@1.0.0
  - model-layer@1.0.0
    - database-layer@1.0.0
      - network-utility@1.0.0 (Vulnerable!)

Esto se publica en un registro especial al que npm accederÃ¡ la prÃ³xima vez que ejecute npm audit. Desde npm v6+, se te informarÃ¡ de esto despuÃ©s de cada npm install:

1 vulnerabilities (0 moderate, 1 high)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Luego ejecutas npm audit fix, y npm intenta instalar la Ãºltima versiÃ³n de network-utility@1.0.1 con la correcciÃ³n incluida. Si la capa de base de datos especifica que depende no exactamente de network-utility@1.0.0 sino de algÃºn rango permisible que incluya 1.0.1, la correcciÃ³n "simplemente funciona" y obtienes una aplicaciÃ³n funcional:

your-app
  - view-library@1.0.0
  - design-system@1.0.0
  - model-layer@1.0.0
    - database-layer@1.0.0
      - network-utility@1.0.1 (Fixed!)

Alternativamente, tal vez database-layer@1.0.0 depende estrictamente de network-utility@1.0.0. En ese caso, el mantenedor de database-layer debe lanzar una nueva versiÃ³n tambiÃ©n, que permita network-utility@1.0.1 en su lugar:

your-app
  - view-library@1.0.0
  - design-system@1.0.0
  - model-layer@1.0.0
    - database-layer@1.0.1 (Updated to allow the fix.)
      - network-utility@1.0.1 (Fixed!)

Finalmente, si no hay forma de actualizar el Ã¡rbol de dependencias correctamente, puedes intentar npm audit fix --force. Se supone que esto se usa si database-layer no acepta la nueva versiÃ³n de network-utility y tampoco lanza una actualizaciÃ³n para aceptarla. AsÃ­ que estÃ¡s tomando las cosas en tus propias manos, arriesgÃ¡ndote potencialmente a cambios que podrÃ­an romper el sistema. Parece una opciÃ³n razonable.

AsÃ­ es como se supone que funciona npm audit en teorÃ­a.

Como alguien sabio dijo, en teorÃ­a no hay diferencia entre teorÃ­a y prÃ¡ctica. Pero en la prÃ¡ctica sÃ­ la hay. Y ahÃ­ es donde comienza toda la diversiÃ³n.

Â¿Por quÃ© estÃ¡ roto npm audit?
Veamos cÃ³mo funciona esto en la prÃ¡ctica. UsarÃ© Create React App para mis pruebas.

Si no estÃ¡s familiarizado con Ã©l, es una fachada de integraciÃ³n que combina varias otras herramientas, incluyendo Babel, webpack, TypeScript, ESLint, PostCSS, Terser y otras. Create React App toma tu cÃ³digo fuente de JavaScript y lo convierte en una carpeta estÃ¡tica de HTML+JS+CSS. Cabe destacar que no produce una aplicaciÃ³n de Node.js.

Â¡Creemos un nuevo proyecto!

npx create-react-app myapp

Inmediatamente despuÃ©s de crear un proyecto, veo esto:

found 5 vulnerabilities (3 moderate, 2 high)
  run `npm audit fix` to fix them, or `npm audit` for details.

Â¡Oh no, eso parece malo! Â¡Mi aplicaciÃ³n reciÃ©n creada ya es vulnerable!

O eso es lo que me dice npm.

Ejecutemos npm audit para ver quÃ© sucede.

Primera "vulnerabilidad"
AquÃ­ estÃ¡ el primer problema reportado por npm audit:



â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Moderate      â”‚ Regular Expression Denial of Service                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Package       â”‚ browserslist                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Patched in    â”‚ >=4.16.5                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Dependency of â”‚ react-scripts                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Path          â”‚ react-scripts > react-dev-utils > browserslist               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ More info     â”‚ https://npmjs.com/advisories/1747                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜



Aparentemente, browserslist es vulnerable. Â¿QuÃ© es eso y cÃ³mo se usa? Create React App genera archivos CSS optimizados para los navegadores que apuntan. Por ejemplo, puedes indicar que solo apuntas a navegadores modernos en tu package.json:

  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  }

Entonces, no incluirÃ¡ hacks flexbox obsoletos en la salida. Dado que varias herramientas dependen del mismo formato de configuraciÃ³n para los navegadores que se apuntan, Create React App utiliza el paquete compartido browserslist para analizar el archivo de configuraciÃ³n.

Entonces, Â¿cuÃ¡l es la vulnerabilidad aquÃ­? "NegaciÃ³n de servicio de expresiÃ³n regular" significa que hay una expresiÃ³n regular en browserslist que, con una entrada maliciosa, podrÃ­a volverse muy lenta. Por lo tanto, un atacante puede crear una cadena de configuraciÃ³n especial que, cuando se pasa a browserslist, podrÃ­a ralentizarlo exponencialmente. Esto suena mal...

Â¿Espera, Â¿quÃ©?! Recordemos cÃ³mo funciona su aplicaciÃ³n. Tiene un archivo de configuraciÃ³n en SU mÃ¡quina. Construye SU proyecto. Obtiene HTML+CSS+JS estÃ¡tico en una carpeta. Lo coloca en hosting estÃ¡tico. Simplemente no hay forma de que el usuario de su aplicaciÃ³n afecte la configuraciÃ³n de su package.json. Esto no tiene ningÃºn sentido. Si el atacante ya tiene acceso a su mÃ¡quina y puede cambiar sus archivos de configuraciÃ³n, Â¡tiene un problema mucho mÃ¡s grande que las expresiones regulares(regex) lentas!

Bueno, supongo que esta "vulnerabilidad" "Moderada" no es ni moderada ni una vulnerabilidad en el contexto de un proyecto. Sigamos adelante.

Veredicto: esta "vulnerabilidad" es absurda en este contexto.

Segunda "vulnerabilidad"
AquÃ­ estÃ¡ el siguiente problema que npm audit ha informado Ãºtilmente:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Moderate      â”‚ Regular expression denial of service                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Package       â”‚ glob-parent                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Patched in    â”‚ >=5.1.2                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Dependency of â”‚ react-scripts                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Path          â”‚ react-scripts > webpack-dev-server > chokidar > glob-parent  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ More info     â”‚ https://npmjs.com/advisories/1751                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Veamos la cadena de dependencias webpack-dev-server > chokidar > glob-parent. AquÃ­, webpack-dev-server es un servidor de desarrollo que se utiliza para servir rÃ¡pidamente tu aplicaciÃ³n localmente. Utiliza chokidar para observar tu sistema de archivos en busca de cambios (como cuando guardas un archivo en tu editor). Y utiliza glob-parent para extraer una parte de la ruta del sistema de archivos de un patrÃ³n de observaciÃ³n del sistema de archivos.

Â¡Desafortunadamente, glob-parent es vulnerable! Si un atacante suministra una ruta de archivo especialmente diseÃ±ada, podrÃ­a hacer que esta funciÃ³n sea exponencialmente lenta, lo que...

Â¡Espera, Â¿quÃ©?! El servidor de desarrollo estÃ¡ en TU computadora. Los archivos estÃ¡n en TU computadora. El observador de archivos estÃ¡ utilizando la configuraciÃ³n que has especificado. Ninguna de esta lÃ³gica sale de tu computadora. Si tu atacante es lo suficientemente sofisticado como para iniciar sesiÃ³n en tu mÃ¡quina durante el desarrollo local, lo Ãºltimo que querrÃ¡n hacer es crear rutas de archivo especiales y largas para ralentizar tu desarrollo. QuerrÃ¡n robar tus secretos. AsÃ­ que esta amenaza es absurda.

Parece que esta "vulnerabilidad moderada" no era ni moderada ni una vulnerabilidad en el contexto de un proyecto.

Veredicto: esta "vulnerabilidad" es absurda en este contexto.

Tercera "vulnerabilidad":
Veamos esta otra:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Moderate      â”‚ Regular expression denial of service                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Package       â”‚ glob-parent                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Patched in    â”‚ >=5.1.2                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Dependency of â”‚ react-scripts                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Path          â”‚ react-scripts > webpack > watchpack > watchpack-chokidar2 >  â”‚
â”‚               â”‚ chokidar > glob-parent                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ More info     â”‚ https://npmjs.com/advisories/1751                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Espera, es lo mismo que arriba, pero a travÃ©s de una ruta de dependencia diferente.

Veredicto: esta "vulnerabilidad" es absurda en este contexto.

Cuarta "vulnerabilidad":
Â¡Vaya, esta parece ser realmente mala! npm audit tiene el atrevimiento de mostrarla en rojo:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ High          â”‚ Denial of Service                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Package       â”‚ css-what                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Patched in    â”‚ >=5.0.1                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Dependency of â”‚ react-scripts                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Path          â”‚ react-scripts > @svgr/webpack > @svgr/plugin-svgo > svgo >   â”‚
â”‚               â”‚ css-select > css-what                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ More info     â”‚ https://npmjs.com/advisories/1754                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Â¿QuÃ© es este problema de "alta" gravedad? "DenegaciÃ³n de servicio". No quiero que se deniegue el servicio. Eso serÃ­a realmente malo... A menos que...

Veamos el problema. Aparentemente, css-what, que es un analizador de selectores CSS, puede ser lento con una entrada especialmente diseÃ±ada. Este analizador es utilizado por un complemento que genera componentes de React a partir de archivos SVG.

Entonces, lo que esto significa es que si el atacante toma el control de mi mÃ¡quina de desarrollo o de mi cÃ³digo fuente, colocarÃ¡n un archivo SVG especial que tendrÃ¡ un selector CSS especialmente diseÃ±ado en Ã©l, lo que harÃ¡ que mi compilaciÃ³n sea lenta. Eso tiene sentido...

Â¡Espera, quÃ©?! Si el atacante puede modificar el cÃ³digo fuente de mi aplicaciÃ³n, probablemente solo pondrÃ¡n un minero de Bitcoin en Ã©l. Â¿Por quÃ© agregarÃ­an archivos SVG a mi aplicaciÃ³n, a menos que se puedan extraer bitcoins con SVG? Nuevamente, esto no tiene sentido.

Veredicto: esta "vulnerabilidad" es absurda en este contexto.

AsÃ­ que, muy exagerado para ser de gravedad "alta".

Quinta "vulnerabilidad":

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ High          â”‚ Denial of Service                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Package       â”‚ css-what                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Patched in    â”‚ >=5.0.1                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Dependency of â”‚ react-scripts                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Path          â”‚ react-scripts > optimize-css-assets-webpack-plugin > cssnano â”‚
â”‚               â”‚ > cssnano-preset-default > postcss-svgo > svgo > css-select  â”‚
â”‚               â”‚ > css-what                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ More info     â”‚ https://npmjs.com/advisories/1754                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Esto es exactamente lo mismo que arriba.

Veredicto: esta "vulnerabilidad" es absurda en este contexto.

Â¿Seguimos adelante?
Hasta ahora, el pastorcito ha gritado "lobo" cinco veces. Dos de ellos son duplicados. El resto son problemas absurdos que no tienen importancia en el contexto de cÃ³mo se utilizan estas dependencias.

Cinco alarmas falsas no serÃ­an tan malas.

Desafortunadamente, hay cientos.

AquÃ­ hay algunos hilos tÃ­picos, pero hay muchos mÃ¡s enlazados desde aquÃ­:

[img]

He pasado varias horas revisando todos los problemas de npm audit reportados en los Ãºltimos meses, y todos parecen ser falsos positivos en el contexto de una herramienta de compilaciÃ³n como Create React App.

Por supuesto, es posible arreglarlos. PodrÃ­amos flexibilizar algunas de las dependencias de nivel superior para que no sean exactas (lo que llevarÃ­a a que se introduzcan errores en los parches con mÃ¡s frecuencia). PodrÃ­amos hacer mÃ¡s versiones solo para estar por delante de este teatro de seguridad.

Pero esto es insuficiente. Â¡ImagÃ­nese si sus pruebas fallaran el 99% de las veces por razones falsas! Esto desperdicia aÃ±os de esfuerzo y hace que todos sean miserables:

- Hace miserable a los principiantes porque se encuentran con esto como su primera experiencia de programaciÃ³n en el ecosistema Node.js. Como si instalar Node.js/npm no fuera lo suficientemente confuso (buena suerte si agregaste sudo en alguna parte porque un tutorial te lo dijo), esto es lo que les espera cuando intentan ejemplos en lÃ­nea o incluso cuando crean un proyecto. Un principiante no sabe quÃ© es una RegExp. Por supuesto, no tienen el conocimiento para poder saber si un DDoS de RegExp o la contaminaciÃ³n de prototipos es algo de lo que preocuparse cuando estÃ¡n usando una herramienta de construcciÃ³n para producir un sitio HTML+CSS+JS estÃ¡tico.
- Hace miserable a los desarrolladores experimentados porque tienen que perder tiempo haciendo trabajo obviamente innecesario o pelear con sus departamentos de seguridad tratando de explicar cÃ³mo npm audit es una herramienta rota no adecuada para auditorÃ­as de seguridad reales por diseÃ±o. SÃ­, de alguna manera se convirtiÃ³ en una predeterminada en este estado.
- Hace miserable a los mantenedores porque en lugar de trabajar en correcciones de errores y mejoras, tienen que incorporar correcciones de vulnerabilidades falsas que no pueden afectar su proyecto porque, de lo contrario, sus usuarios estÃ¡n frustrados, asustados o ambas cosas.
- AlgÃºn dÃ­a, harÃ¡ miserable a nuestros usuarios porque hemos entrenado a toda una generaciÃ³n de desarrolladores para que no entiendan las advertencias debido a estar abrumados o simplemente las ignoren porque siempre aparecen, pero los desarrolladores experimentados les dicen (correctamente) que no hay un problema real en cada caso.

No ayuda que npm audit fix (que la herramienta sugiere usar) tenga errores. Hoy ejecutÃ© npm audit fix --force y esto bajÃ³ la dependencia principal a una versiÃ³n de hace tres aÃ±os con vulnerabilidades reales. Gracias, npm, buen trabajo.

Â¿QuÃ© sigue?
No sÃ© cÃ³mo solucionar esto. Pero yo no agreguÃ© este sistema en primer lugar, asÃ­ que probablemente no sea la mejor persona para resolverlo. Todo lo que sÃ© es que estÃ¡ terriblemente roto.

Hay algunas soluciones posibles que he visto.

- Mover la dependencia a devDependencies si no se ejecuta en producciÃ³n. Esto ofrece una forma de especificar que alguna dependencia no se utiliza en rutas de cÃ³digo de producciÃ³n, por lo que no hay riesgo asociado con ella. Sin embargo, esta soluciÃ³n es defectuosa:

    - npm audit todavÃ­a advierte por las dependencias de desarrollo de manera predeterminada. Tienes que saber que para no ver las advertencias de las dependencias de desarrollo debes ejecutar npm audit --production. Las personas que saben hacer esto probablemente ya no confÃ­an en Ã©l de todas formas. Esto tampoco ayuda a los principiantes o a las personas que trabajan en empresas cuyos departamentos de seguridad quieren auditar todo.
    - npm install todavÃ­a usa informaciÃ³n de la simple auditorÃ­a de npm, por lo que efectivamente seguirÃ¡s viendo todos los falsos positivos cada vez que instales algo.
    - Como cualquier profesional de seguridad te dirÃ¡, las dependencias de desarrollo en realidad son un vector de ataque, y quizÃ¡s uno de los mÃ¡s peligrosos porque es muy difÃ­cil de detectar y el cÃ³digo se ejecuta con supuestos de alta confianza. Es por eso que la situaciÃ³n es tan mala en particular: cualquier problema real queda enterrado debajo de docenas de no problemas que npm audit estÃ¡ entrenando a personas y mantenedores a ignorar. Es solo cuestiÃ³n de tiempo hasta que esto suceda.
- Incorporar todas las dependencias durante la publicaciÃ³n. Esto es lo que veo cada vez mÃ¡s que hacen paquetes similares a Create React App. Por ejemplo, tanto Vite como Next.js simplemente empaquetan sus dependencias directamente en el paquete en lugar de confiar en el mecanismo npm node_modules. Desde el punto de vista del mantenedor, las ventajas son claras: obtienes un tiempo de arranque mÃ¡s rÃ¡pido, descargas mÃ¡s pequeÃ±as y, como bonificaciÃ³n, no hay informes falsos de vulnerabilidades de tus usuarios. Es una forma ingeniosa de engaÃ±ar al sistema, pero me preocupa los incentivos que npm estÃ¡ creando para el ecosistema. La incorporaciÃ³n de dependencias va en contra de todo el propÃ³sito de npm.
- Ofrecer alguna forma de impugnar informes de vulnerabilidades. El problema no es del todo desconocido para Node.js y npm, por supuesto. Diferentes personas han trabajado en diferentes sugerencias para solucionarlo. Por ejemplo, hay una propuesta para una forma de resolver manualmente las advertencias de auditorÃ­a para que no se muestren de nuevo. Sin embargo, esto todavÃ­a pone la carga sobre los usuarios de la aplicaciÃ³n, que no necesariamente tienen contexto sobre quÃ© vulnerabilidades mÃ¡s profundas en el Ã¡rbol son reales o falsas. TambiÃ©n tengo una propuesta: necesito una forma de marcar para mis usuarios que cierta vulnerabilidad no puede afectarlos de ninguna manera. Si no confÃ­as en mi juicio, Â¿por quÃ© estÃ¡s ejecutando mi cÃ³digo en tu computadora? EstarÃ­a encantado de discutir otras opciones tambiÃ©n.

La raÃ­z del problema es que npm agregÃ³ un comportamiento predeterminado que, en muchas situaciones, conduce a una tasa de falsos positivos del 99%+, crea una experiencia de programaciÃ³n inicial increÃ­blemente confusa, hace que la gente luche con los departamentos de seguridad, hace que los mantenedores nunca quieran lidiar con el ecosistema de Node.js nunca mÃ¡s, y en algÃºn momento llevarÃ¡ a que vulnerabilidades realmente malas pasen desapercibidas.

Algo debe hacerse.

Mientras tanto, planeo cerrar todos los problemas de GitHub de npm audit que vea en el futuro y que no correspondan a una vulnerabilidad real que pueda afectar al proyecto. Invito a otros maintainers a adoptar la misma polÃ­tica. Esto crearÃ¡ frustraciÃ³n para nuestros usuarios, pero el nÃºcleo del problema estÃ¡ en npm. Estoy cansado de este teatro de seguridad. Node.js/npm tienen todo el poder para solucionar el problema. Estoy en contacto con ellos y espero ver este problema priorizado.

Hoy en dÃ­a, npm audit estÃ¡ roto por diseÃ±o.

Principiantes, desarrolladores experimentados, maintainers, departamentos de seguridad y, lo mÃ¡s importante, nuestros usuarios merecen algo mejor.